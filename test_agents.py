#!/usr/bin/env python3
"""
Test script for the 7-agent resume extraction system
"""
import asyncio
import sys
import os
import json

# Add the backend directory to path for imports
sys.path.append('/Users/aksar/Desktop/ideas/ResumeAgentAI/backend')

from app.services.ai_service import AIService

async def test_7_agent_system():
    """Test the comprehensive 7-agent extraction system"""
    
    # Sample resume content that should trigger all agents
    test_resume_content = """
    Muhammad Zaid
    Senior Software Engineer (Backend Developer Nodejs) at Smash Cloud Pakistan
    
    Contact Information:
    Email: muhammadzaid435@gmail.com
    Phone: 03034006155
    Location: Gujranwala, Pakistan
    LinkedIn: https://linkedin.com/in/muhammadzaid
    GitHub: https://github.com/zaid123
    Portfolio: https://zaidportfolio.com
    
    PROFESSIONAL SUMMARY
    I'm an experienced Backend Software Engineer specializing in Node.js, Express.js, and NestJS 
    with over 6 years of hands-on experience in developing scalable backend systems, APIs, and 
    microservices architectures.
    
    WORK EXPERIENCE
    
    Senior Software Engineer
    SMASH CLOUD MEDIA - Lahore, Pakistan | Jul 2022 - Present
    ‚Ä¢ Led the design and optimization of scalable backend systems using Node.js and NestJS
    ‚Ä¢ Implemented microservices architecture reducing system response time by 40%
    ‚Ä¢ Mentored junior developers and conducted code reviews
    
    Backend Developer
    BIZZCLAN | Jun 2022 - Jul 2023
    ‚Ä¢ Worked part-time building and optimizing APIs using Node.js, Express.js, and MongoDB
    ‚Ä¢ Developed RESTful APIs serving 10K+ daily active users
    ‚Ä¢ Integrated third-party payment systems including PayPal and Stripe
    
    Software Engineer
    BIG IMMERSIVE | Jun 2021 - Jul 2022
    ‚Ä¢ Specialized in developing and optimizing backend systems for NFT marketplace
    ‚Ä¢ Built blockchain integration using Web3.js and Ethereum smart contracts
    ‚Ä¢ Optimized database queries resulting in 60% performance improvement
    
    Software Engineer
    DELINE MEDIA, LLC | Sep 2020 - Jun 2021
    ‚Ä¢ Worked as a Backend Developer developing backend applications for Ovada Apps
    ‚Ä¢ Implemented real-time messaging systems using Socket.io
    ‚Ä¢ Managed AWS infrastructure including EC2, RDS, and S3
    
    Full Stack Developer
    APPCRATES | Jan 2019 - Oct 2020
    ‚Ä¢ Specialized in developing and optimizing backend applications using Node.js and Laravel
    ‚Ä¢ Built complete web applications from frontend to backend
    ‚Ä¢ Implemented automated testing and CI/CD pipelines
    
    TECHNICAL SKILLS & EXPERTISE
    
    Programming Languages:
    ‚Ä¢ Node.js (Expert - 6 years)
    ‚Ä¢ JavaScript (Expert - 6 years) 
    ‚Ä¢ TypeScript (Advanced - 4 years)
    ‚Ä¢ Python (Intermediate - 2 years)
    ‚Ä¢ PHP (Intermediate - 3 years)
    
    Frameworks & Libraries:
    ‚Ä¢ Express.js (Expert - 6 years)
    ‚Ä¢ NestJS (Advanced - 3 years)
    ‚Ä¢ React (Advanced - 4 years)
    ‚Ä¢ Angular (Intermediate - 3 years)
    ‚Ä¢ Laravel (Intermediate - 3 years)
    
    Databases:
    ‚Ä¢ MySQL (Advanced - 5 years)
    ‚Ä¢ PostgreSQL (Advanced - 4 years)
    ‚Ä¢ MongoDB (Advanced - 5 years)
    ‚Ä¢ Redis (Intermediate - 3 years)
    
    Cloud & DevOps:
    ‚Ä¢ AWS (Advanced - 3 years)
    ‚Ä¢ Docker (Advanced - 3 years)
    ‚Ä¢ Kubernetes (Intermediate - 2 years)
    ‚Ä¢ Jenkins (Intermediate - 2 years)
    
    EDUCATION
    
    Bachelor of Software Engineering (BSSE)
    University of Sargodha | Computer Science Department
    2014 - 2018 | GPA: 2.9/4.0
    
    Relevant Coursework: Data Structures, Algorithms, Database Systems, Software Engineering, 
    Operating Systems, Computer Networks
    
    Intermediate in Science (FSc)
    Punjab College of Science | Pre-Engineering
    2012 - 2014 | Grade: 67%
    
    Subjects: Physics, Chemistry, Mathematics, Computer Science
    
    KEY PROJECTS
    
    A4A - Analytics for All
    ‚Ä¢ Backend development of the A4A app, focusing on Admin Panel, Feature Enhancements
    ‚Ä¢ Implemented real-time analytics dashboard serving 5000+ concurrent users
    ‚Ä¢ Technologies: Node.js, NestJS, PostgreSQL, Amazon S3, Redis
    ‚Ä¢ GitHub: https://github.com/zaid/a4a-backend
    
    TeamCap - Team Capacity Management
    ‚Ä¢ React Native-based SaaS application designed for consulting and advisory firms
    ‚Ä¢ Built scalable backend APIs handling 50K+ requests per day
    ‚Ä¢ Technologies: AWS Lambda, Node.js, Express.js, MySQL, Redis
    ‚Ä¢ URL: https://teamcap.app
    
    BlackBooking - Professional Booking Platform
    ‚Ä¢ MERN stack-based platform designed to connect users with professionals
    ‚Ä¢ Implemented secure payment processing with PayPal and Stripe integration
    ‚Ä¢ Technologies: Node.js, Express.js, PayPal Integration, MongoDB, React
    ‚Ä¢ GitHub: https://github.com/zaid/blackbooking
    
    Virtua - NFT Marketplace
    ‚Ä¢ NFT marketplace that enables buying, selling, and trading NFTs
    ‚Ä¢ Built microservices architecture handling blockchain transactions
    ‚Ä¢ Technologies: Node.js, MySQL, Express.js, AWS Lambda, Microservices, Web3.js
    ‚Ä¢ URL: https://virtua.marketplace
    
    CERTIFICATIONS & ACHIEVEMENTS
    
    ‚Ä¢ AWS Certified Solutions Architect - Associate (2023)
    ‚Ä¢ MongoDB Certified Developer (2022)
    ‚Ä¢ Node.js Certified Developer (2021)
    ‚Ä¢ Google Cloud Platform Fundamentals (2020)
    ‚Ä¢ Best Employee Award - SMASH CLOUD MEDIA (2023)
    ‚Ä¢ Innovation Award - BIG IMMERSIVE (2022)
    
    LANGUAGES
    
    ‚Ä¢ Urdu - Native
    ‚Ä¢ English - Advanced (Professional working proficiency)
    ‚Ä¢ Arabic - Beginner
    
    PUBLICATIONS & ARTICLES
    
    ‚Ä¢ "Microservices Architecture Best Practices" - Medium (2023)
    ‚Ä¢ "Scaling Node.js Applications" - Dev.to (2022)
    ‚Ä¢ "Database Optimization Techniques" - Personal Blog (2021)
    
    VOLUNTEER EXPERIENCE
    
    Tech Mentor
    Code for Pakistan | 2021 - Present
    ‚Ä¢ Mentoring students in web development and backend technologies
    ‚Ä¢ Conducting workshops on Node.js and API development
    
    INTERESTS & HOBBIES
    
    ‚Ä¢ Open Source Contribution
    ‚Ä¢ Technical Writing and Blogging
    ‚Ä¢ Chess Playing
    ‚Ä¢ Photography
    ‚Ä¢ Traveling and Cultural Exploration
    """
    
    print("ü§ñ Testing 7-Agent Resume Extraction System")
    print("=" * 60)
    
    try:
        ai_service = AIService()
        print("‚úÖ AIService initialized successfully")
        
        print("\nüöÄ Starting comprehensive multi-agent extraction...")
        result = await ai_service.process_resume_content(test_resume_content)
        
        if "error" in result:
            print(f"‚ùå ERROR: {result}")
            return False
        
        print("\nüìä EXTRACTION RESULTS:")
        print("=" * 40)
        
        # Test Agent 1: Personal Info & Contact
        print("\nü§ñ Agent 1 - Personal Info & Contact:")
        print(f"   Name: {result.get('name', 'Not extracted')}")
        print(f"   Designation: {result.get('designation', 'Not extracted')}")
        print(f"   Location: {result.get('location', 'Not extracted')}")
        print(f"   Profession: {result.get('profession', 'Not extracted')}")
        print(f"   Summary length: {len(result.get('summary', ''))}")
        
        contact_info = result.get('contact_info', {})
        print(f"   Contact fields: {list(contact_info.keys())}")
        
        # Test Agent 2: Experience & Calculation
        print("\nü§ñ Agent 2 - Experience & Calculation:")
        print(f"   Total Experience: {result.get('experience', 'Not calculated')}")
        experience_details = result.get('experience_details', [])
        print(f"   Experience entries: {len(experience_details)}")
        for i, exp in enumerate(experience_details[:3]):  # Show first 3
            print(f"     {i+1}. {exp.get('position', '')} at {exp.get('company', '')}")
        
        # Test Agent 3: Skills
        print("\nü§ñ Agent 3 - Skills:")
        skills = result.get('skills', [])
        print(f"   Skills extracted: {len(skills)}")
        for i, skill in enumerate(skills[:5]):  # Show first 5
            print(f"     {i+1}. {skill.get('name', '')} ({skill.get('level', '')}, {skill.get('years', 0)} years)")
        
        # Test Agent 4: Education
        print("\nü§ñ Agent 4 - Education:")
        education = result.get('education', [])
        print(f"   Education entries: {len(education)}")
        for i, edu in enumerate(education):
            print(f"     {i+1}. {edu.get('degree', '')} from {edu.get('institution', '')}")
        
        # Test Agent 5: Projects
        print("\nü§ñ Agent 5 - Projects:")
        projects = result.get('projects', [])
        print(f"   Projects extracted: {len(projects)}")
        for i, proj in enumerate(projects):
            tech_count = len(proj.get('technologies', []))
            print(f"     {i+1}. {proj.get('name', '')} ({tech_count} technologies)")
        
        # Test Agent 6: Languages
        print("\nü§ñ Agent 6 - Languages:")
        languages = result.get('languages', [])
        print(f"   Languages extracted: {len(languages)}")
        for i, lang in enumerate(languages):
            print(f"     {i+1}. {lang.get('name', '')} ({lang.get('proficiency', '')})")
        
        # Test Agent 7: Additional Info
        print("\nü§ñ Agent 7 - Additional Info:")
        certifications = result.get('certifications', [])
        awards = result.get('awards', [])
        publications = result.get('publications', [])
        volunteer = result.get('volunteer_experience', [])
        interests = result.get('interests', [])
        
        print(f"   Certifications: {len(certifications)}")
        print(f"   Awards: {len(awards)}")
        print(f"   Publications: {len(publications)}")
        print(f"   Volunteer Experience: {len(volunteer)}")
        print(f"   Interests: {len(interests)}")
        
        # Validate key requirements from the user
        print("\n‚úÖ VALIDATION RESULTS:")
        print("=" * 40)
        
        # Check field mapping quality
        designation = result.get('designation', '')
        location = result.get('location', '')
        
        print(f"üîç Designation Clean: {'‚úÖ' if designation and 'at' not in designation and 'Pakistan' not in designation else '‚ùå'}")
        print(f"   Value: '{designation}'")
        
        print(f"üîç Location Real: {'‚úÖ' if location and 'Cloud' not in location else '‚ùå'}")
        print(f"   Value: '{location}'")
        
        print(f"üîç Experience Calculated: {'‚úÖ' if result.get('experience') and result.get('experience') != '0 years' else '‚ùå'}")
        print(f"   Value: '{result.get('experience')}'")
        
        print(f"üîç Complete Contact Info: {'‚úÖ' if len(contact_info) >= 3 else '‚ùå'}")
        print(f"   Fields: {len(contact_info)}")
        
        print(f"üîç All Sections Extracted: {'‚úÖ' if all([len(skills) > 0, len(experience_details) > 0, len(education) > 0, len(projects) > 0, len(languages) > 0]) else '‚ùå'}")
        
        # Summary
        total_fields = len([v for v in result.values() if v and v != [] and v != {} and v != ""])
        print(f"\nüìà SUMMARY: {total_fields} fields extracted successfully")
        
        return True
        
    except Exception as e:
        print(f"‚ùå TEST FAILED: {str(e)}")
        import traceback
        traceback.print_exc()
        return False

if __name__ == "__main__":
    success = asyncio.run(test_7_agent_system())
    if success:
        print("\nüéâ 7-Agent System Test PASSED!")
    else:
        print("\nüí• 7-Agent System Test FAILED!")